1. Crear Namespace:
kubectl create namespace "tarea-namespace"


2. Crear Secrets
kubectl create secret generic "db-conn" --from-literal="DATABASE_URL=postgresql://usuario:password@localhost:5432/appdb" --namespace "tarea-namespace"

kubectl create secret generic "app-secrets" --from-literal="APP_SECRET=mi-clave-secreta-de-ejemplo-12345" --namespace "tarea-namespace"


3. Crear ConfigMap
kubectl create configmap "app-config" --from-literal="APP_ENV=production" --from-literal="OTEL_EXPORTER=azure" --namespace "tarea-namespace"


4. Aplicar Deployments y Services
kubectl apply --filename "api-deploy.yaml" --namespace "tarea-namespace"
kubectl apply --filename "api-svc.yaml" --namespace "tarea-namespace"
kubectl apply --filename "web-deploy.yaml" --namespace "tarea-namespace"
kubectl apply --filename "web-svc.yaml" --namespace "tarea-namespace"


Archivos YAML que estan en la carpeta k8s/:
k8s/api-deploy.yaml:

apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: api
  template:
    metadata:
      labels:
        app: api
    spec:
      containers:
      - name: api
        image: acruno.azurecr.io/tareaapi:v3
        ports:
        - containerPort: 5000
        env:
        - name: APP_ENV
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: APP_ENV
        - name: APP_SECRET
          valueFrom:
            secretKeyRef:
              name: app-secrets
              key: APP_SECRET





k8s/api-svc.yaml:

apiVersion: v1
kind: Service
metadata:
  name: api-service
spec:
  selector:
    app: api
  ports:
  - port: 80
    targetPort: 5000
  type: LoadBalancer



k8s/web-deploy.yaml:

apiVersion: apps/v1
kind: Deployment
metadata:
  name: web-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: web
  template:
    metadata:
      labels:
        app: web
    spec:
      containers:
      - name: web
        image: acruno.azurecr.io/tareaweb:v3
        ports:
        - containerPort: 5000





Comandos para exportar la configuraciÃ³n actual:
# Exportar secrets (sin los valores por seguridad)
kubectl get secret db-conn -n tarea-namespace -o yaml --export > k8s/secret-db.yaml
kubectl get secret app-secrets -n tarea-namespace -o yaml --export > k8s/secret-app.yaml

# Exportar configmap
kubectl get configmap app-config -n tarea-namespace -o yaml --export > k8s/configmap.yaml



Archivo .env de ejemplo:
DATABASE_URL=postgresql://usuario:password@localhost:5432/appdb
APP_SECRET=mi-clave-secreta-de-ejemplo-12345
APP_ENV=production
OTEL_EXPORTER=azure